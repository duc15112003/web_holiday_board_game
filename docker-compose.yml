version: '3.8'

services:
  mongo:
    image: mongo:7
    container_name: lucky_spin_mongo
    ports:
      - "${MONGO_PORT:-27017}:27017"
    volumes:
      - mongo_data:/data/db
    networks:
      - lucky-net
    restart: always

  mongo-express:
    image: mongo-express
    container_name: lucky_spin_mongo_express
    ports:
      - "${MONGO_EXPRESS_PORT:-8081}:8081"
    environment:
      - ME_CONFIG_MONGODB_SERVER=mongo
      - ME_CONFIG_BASICAUTH_USERNAME=${MONGO_EXPRESS_USER:-admin}
      - ME_CONFIG_BASICAUTH_PASSWORD=${MONGO_EXPRESS_PASS:-pass}
    depends_on:
      - mongo
    networks:
      - lucky-net
    restart: always

  socket-server:
    build:
      context: ./socket-server
      dockerfile: Dockerfile
    ports:
      - "${SOCKET_PORT:-3001}:3001"
    environment:
      - PORT=3001
      - CORS_ORIGIN=${CORS_ORIGIN:-*}
      - MONGODB_URI=${MONGODB_URI:-mongodb://mongo:27017/lucky_spin_db}
    restart: always
    networks:
      - lucky-net
    depends_on:
      - mongo

  frontend:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - VITE_SOCKET_URL=${VITE_SOCKET_URL:-http://localhost:3001}
        - VITE_API_URL=${VITE_API_URL:-http://localhost:3001}
    ports:
      - "${FRONTEND_PORT:-81}:80"
    networks:
      - lucky-net
    restart: always
    depends_on:
      - socket-server

networks:
  lucky-net:
    driver: bridge

volumes:
  mongo_data:
